<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Segundo C√©rebro</title>
    
    <script src="https://cdn.jsdelivr.net/npm/chrono-node@2.4.1/dist/chrono.min.js"></script>

    <style>
        /* Estilo Visual iOS Clean */
        :root {
            --bg-color: #f2f2f7;
            --card-color: #ffffff;
            --text-primary: #000000;
            --text-secondary: #8e8e93;
            --accent: #007aff;
            --danger: #ff3b30;
            --success: #34c759;
            --warning: #ffcc00;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            padding: 20px;
            color: var(--text-primary);
            -webkit-font-smoothing: antialiased;
        }

        h1 { font-size: 24px; margin-bottom: 20px; font-weight: 700; }

        /* √Årea de Input */
        .input-area {
            background: var(--card-color);
            padding: 15px;
            border-radius: 14px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            margin-bottom: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        textarea {
            width: 100%;
            border: none;
            font-size: 17px;
            font-family: inherit;
            resize: none;
            outline: none;
            height: 60px;
            background: transparent;
        }

        .btn-add {
            background-color: var(--accent);
            color: white;
            border: none;
            padding: 12px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: opacity 0.2s;
        }
        .btn-add:active { opacity: 0.7; }

        /* Lista de Tarefas */
        #task-list { list-style: none; padding: 0; margin: 0; }

        .task-card {
            background: var(--card-color);
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.03);
            display: flex;
            flex-direction: column;
            gap: 8px;
            transition: transform 0.2s;
        }

        .task-header { display: flex; justify-content: space-between; align-items: flex-start; }
        
        .task-text { font-size: 17px; line-height: 1.4; flex-grow: 1; margin-right: 10px; }
        
        .task-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 5px;
            font-size: 13px;
            color: var(--text-secondary);
        }

        /* Tags e Bot√µes */
        .tag {
            padding: 4px 8px;
            border-radius: 6px;
            font-weight: 600;
            font-size: 11px;
            text-transform: uppercase;
        }
        .tag-money { background: #e5f9e7; color: var(--success); }
        .tag-health { background: #e5f0ff; color: var(--accent); }
        .tag-urgent { background: #ffe5e5; color: var(--danger); }
        .tag-general { background: #f2f2f7; color: var(--text-secondary); }

        .actions { display: flex; gap: 10px; }

        .btn-icon {
            background: none;
            border: none;
            font-size: 18px;
            cursor: pointer;
            padding: 5px;
        }
        
        .btn-calendar { color: var(--accent); }
        .btn-delete { color: var(--text-secondary); }

        /* Detalhe de Data */
        .date-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            background: #f2f2f7;
            padding: 4px 8px;
            border-radius: 6px;
            color: var(--text-primary);
        }

    </style>
</head>
<body>

    <h1>üß† Segundo C√©rebro</h1>

    <div class="input-area">
        <textarea id="taskInput" placeholder="Digite ou dite algo... (ex: Pagar dentista amanh√£ √†s 15h)"></textarea>
        <button class="btn-add" onclick="processInput()">Adicionar Lembran√ßa</button>
    </div>

    <ul id="task-list">
        </ul>

    <script>
        // --- L√ìGICA DO APP ---

        let tasks = JSON.parse(localStorage.getItem('myTasks')) || [];

        // 1. Processar o Texto (O "C√©rebro")
        function processInput() {
            const inputField = document.getElementById('taskInput');
            const text = inputField.value.trim();

            if (!text) return;

            // Usando a biblioteca Chrono para detectar datas no texto
            const parsedDate = chrono.parse(text);
            
            let taskDate = null;
            let cleanText = text;

            // Se achou uma data, separa ela
            if (parsedDate.length > 0) {
                taskDate = parsedDate[0].start.date();
                // Opcional: Remover o texto da data do t√≠tulo da tarefa pra ficar limpo?
                // Por enquanto deixamos o texto completo para contexto.
            }

            // Detectar Categoria
            let category = 'Geral';
            const lowerText = text.toLowerCase();
            if (lowerText.includes('pagar') || lowerText.includes('compra') || lowerText.includes('banco') || lowerText.includes('pix')) category = 'Financeiro';
            else if (lowerText.includes('m√©dico') || lowerText.includes('dentista') || lowerText.includes('rem√©dio')) category = 'Sa√∫de';
            else if (lowerText.includes('amanh√£') || lowerText.includes('hoje')) category = 'Urgente';

            const newTask = {
                id: Date.now(),
                text: text,
                date: taskDate,
                category: category,
                done: false
            };

            tasks.unshift(newTask); // Adiciona no topo
            saveTasks();
            renderTasks();
            inputField.value = ''; // Limpa o campo
        }

        // 2. Criar Link para o Calend√°rio (O "Pulo do Gato")
        function addToCalendar(taskIndex) {
            const task = tasks[taskIndex];
            if (!task.date) {
                alert("Essa tarefa n√£o tem data detectada!");
                return;
            }

            const startDate = new Date(task.date);
            const endDate = new Date(startDate.getTime() + 60*60*1000); // Dura√ß√£o padr√£o de 1h

            // Formata data para o padr√£o ICS (YYYYMMDDTHHmmSSZ)
            const formatDate = (date) => date.toISOString().replace(/-|:|\.\d\d\d/g,"");

            // Cria o conte√∫do do arquivo .ics
            const icsContent = `BEGIN:VCALENDAR
VERSION:2.0
BEGIN:VEVENT
URL:${document.location.href}
DTSTART:${formatDate(startDate)}
DTEND:${formatDate(endDate)}
SUMMARY:${task.text}
DESCRIPTION:Lembrete criado pelo Segundo C√©rebro
BEGIN:VALARM
TRIGGER:-PT15M
ACTION:DISPLAY
DESCRIPTION:Lembrete
END:VALARM
END:VEVENT
END:VCALENDAR`;

            // Cria um "link invis√≠vel" para baixar o arquivo
            const blob = new Blob([icsContent], { type: 'text/calendar;charset=utf-8' });
            const link = document.createElement('a');
            link.href = window.URL.createObjectURL(blob);
            link.setAttribute('download', 'lembrete.ics');
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // 3. Mostrar na Tela (Render)
        function renderTasks() {
            const list = document.getElementById('task-list');
            list.innerHTML = '';

            tasks.forEach((task, index) => {
                const dateDisplay = task.date ? new Date(task.date).toLocaleString('pt-BR', { weekday: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' }) : 'Sem data';
                
                // Define classe da cor da tag
                let tagClass = 'tag-general';
                if(task.category === 'Financeiro') tagClass = 'tag-money';
                if(task.category === 'Sa√∫de') tagClass = 'tag-health';
                if(task.category === 'Urgente') tagClass = 'tag-urgent';

                const li = document.createElement('li');
                li.className = 'task-card';
                li.innerHTML = `
                    <div class="task-header">
                        <span class="task-text">${task.text}</span>
                        <span class="tag ${tagClass}">${task.category}</span>
                    </div>
                    <div class="task-meta">
                        <div class="date-badge">
                            üìÖ ${dateDisplay}
                        </div>
                        <div class="actions">
                            ${task.date ? `<button class="btn-icon btn-calendar" onclick="addToCalendar(${index})">üîî Agendar</button>` : ''}
                            <button class="btn-icon btn-delete" onclick="deleteTask(${index})">üóëÔ∏è</button>
                        </div>
                    </div>
                `;
                list.appendChild(li);
            });
        }

        // 4. Salvar e Deletar
        function saveTasks() {
            localStorage.setItem('myTasks', JSON.stringify(tasks));
        }

        function deleteTask(index) {
            tasks.splice(index, 1);
            saveTasks();
            renderTasks();
        }

        // Inicia carregando as tarefas salvas
        renderTasks();

    </script>
</body>
</html>
